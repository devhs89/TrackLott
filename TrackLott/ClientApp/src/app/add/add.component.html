<mat-card class="row col-xl-9 m-auto">
  <mat-card-title>Add Combinations</mat-card-title>
  <mat-divider inset class="my-3"></mat-divider>
  <mat-card-content>
    <form [formGroup]="combosFormGroup" (ngSubmit)="onAddCombination()" autocomplete="off">

      <div class="row mb-4">
        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Lottery Name</mat-label>
            <mat-select formControlName="lotteryName" (selectionChange)="onLotterySelect($event)">
              <mat-option *ngFor="let lotto of lotteryNames | keyvalue"
                          value="{{lotto.key}}">{{lotto.value.name}}</mat-option>
            </mat-select>
            <mat-hint>Select a lottery name</mat-hint>
            <mat-error>Invalid lottery name</mat-error>
          </mat-form-field>
        </div>

        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Date</mat-label>
            <!--suppress TypeScriptValidateTypes -->
            <input matInput formControlName="dateAdded" [min]="minDate" [max]="maxDate" placeholder="dd/mm/yyyy"
                   [matDatepicker]="playedDatePicker">
            <mat-datepicker-toggle matSuffix [for]="playedDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #playedDatePicker [touchUi]="(isHandset$ | async)"></mat-datepicker>
            <mat-hint>When were/would these combinations be played?</mat-hint>
            <mat-error>Invalid date</mat-error>
          </mat-form-field>
        </div>
      </div>

      <ng-container *ngIf="allPickedNums.mainNums">
        <mat-card class="mb-2" *ngFor="let row of allPickedNums.mainNums">
          <mat-card-content>
          <span class="m-1" *ngFor="let num of row">
            <ng-container
              *ngTemplateOutlet="numbersSvg; context: {$implicit: {number: num, bgFill: '#673ab7'}}"></ng-container>
          </span>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <div class="row" *ngIf="currPickedNums.mainNums">
        <div class="col-12 col-md-8">
            <span class="m-1" *ngFor="let num of currPickedNums.mainNums">
              <ng-container
                *ngTemplateOutlet="numbersSvg; context: {$implicit: {number: num, bgFill: '#673ab7'}}"></ng-container>
            </span>
        </div>
        <div class="col-12 col-md-8 justify-content-end text-end"
             *ngIf="currPickedNums.mainNums.length >= lotteryNameSelected.standard">
          <button mat-flat-button type="button" color="primary" class="w-auto text-uppercase"
                  (click)="onAddCombination()">
            Add
          </button>
        </div>
      </div>

      <div class="row mb-3" *ngIf="lotteryNameSelected.mainNums">
        <div class="col-auto col-md-7 mb-2 mb-md-0 justify-content-between text-center">
          <mat-button-toggle class="m-0625" style="width: 2.75rem;" (click)="onNumClick(num)"
                             [disabled]="currPickedNums.mainNums.includes(num)"
                             [checked]="currPickedNums.mainNums.includes(num)"
                             *ngFor="let num of lotteryNameSelected.mainNums">{{num}}</mat-button-toggle>
        </div>
      </div>

      <div class="d-flex justify-content-center my-3">
        <button mat-flat-button type="submit" color="primary" class="w-50 text-uppercase">
          Save
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<ng-template #numbersSvg let-options>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="40" height="40">
    <style>
      .textNum {
        font: 400 1.1rem 'Roboto Mono', monospace;
        fill: #f8f9fa;
      }
    </style>
    <g>
      <circle r="20" cx="20" cy="20" [ngStyle]="{'fill': options.bgFill}"></circle>
      <text x="20" y="26" text-anchor="middle" class="textNum">{{options.number}}</text>
    </g>
  </svg>
</ng-template>
